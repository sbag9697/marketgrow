<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸ - MarketGrow</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #1a365d;
            border-bottom: 2px solid #1a365d;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .pending {
            background: #feebc8;
            color: #744210;
            border: 1px solid #fbd38d;
        }
        button {
            background: #1a365d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2c5282;
        }
        .result {
            background: #f7fafc;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <div class="test-title">ğŸ“¡ API ì„œë²„ ìƒíƒœ</div>
        <div id="serverStatus" class="status pending">í™•ì¸ ì¤‘...</div>
        <button onclick="checkServerStatus()">ì„œë²„ ìƒíƒœ í™•ì¸</button>
        <div id="serverResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ‘¤ íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</div>
        <input type="text" id="signupName" placeholder="ì´ë¦„" value="í…ŒìŠ¤íŠ¸ìœ ì €">
        <input type="email" id="signupEmail" placeholder="ì´ë©”ì¼" value="test@example.com">
        <input type="password" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="test1234">
        <button onclick="testSignup()">íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</button>
        <div id="signupResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ”‘ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</div>
        <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼" value="test@example.com">
        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="test1234">
        <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
        <div id="loginResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ“¦ ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ</div>
        <button onclick="testServices()">ì„œë¹„ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="servicesResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ›’ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸</div>
        <button onclick="testOrder()">ì£¼ë¬¸ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <div id="orderResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = 'https://marketgrow-production.up.railway.app/api';
        let authToken = null;

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            const statusDiv = document.getElementById('serverStatus');
            const resultDiv = document.getElementById('serverResult');
            
            statusDiv.className = 'status pending';
            statusDiv.textContent = 'ì„œë²„ ì—°ê²° ì¤‘...';
            
            try {
                const response = await fetch(API_URL + '/health', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… ì„œë²„ ì •ìƒ ì‘ë™ ì¤‘';
                    resultDiv.style.display = 'block';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    throw new Error(data.message || 'ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message;
                resultDiv.style.display = 'block';
                resultDiv.textContent = error.stack;
            }
        }

        // íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
        async function testSignup() {
            const resultDiv = document.getElementById('signupResult');
            
            try {
                const response = await fetch(API_URL + '/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('signupName').value,
                        email: document.getElementById('signupEmail').value,
                        password: document.getElementById('signupPassword').value
                    })
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    alert('âœ… íšŒì›ê°€ì… ì„±ê³µ!');
                } else {
                    alert('âŒ íšŒì›ê°€ì… ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
            }
        }

        // ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            
            try {
                const response = await fetch(API_URL + '/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('loginEmail').value,
                        password: document.getElementById('loginPassword').value
                    })
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    alert('âœ… ë¡œê·¸ì¸ ì„±ê³µ! í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
            }
        }

        // ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ
        async function testServices() {
            const resultDiv = document.getElementById('servicesResult');
            
            try {
                const response = await fetch(API_URL + '/services', {
                    method: 'GET',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': authToken ? `Bearer ${authToken}` : ''
                    }
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    alert(`âœ… ${data.services ? data.services.length : 0}ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                } else {
                    alert('âŒ ì„œë¹„ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
            }
        }

        // ì£¼ë¬¸ í…ŒìŠ¤íŠ¸
        async function testOrder() {
            const resultDiv = document.getElementById('orderResult');
            
            if (!authToken) {
                alert('ë¨¼ì € ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            try {
                const response = await fetch(API_URL + '/orders', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        serviceId: 'instagram-followers',
                        serviceName: 'ì¸ìŠ¤íƒ€ê·¸ë¨ íŒ”ë¡œì›Œ',
                        targetUrl: 'https://instagram.com/test',
                        quantity: 1000,
                        price: 72000
                    })
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    alert('âœ… ì£¼ë¬¸ ìƒì„± ì„±ê³µ!');
                } else {
                    alert('âŒ ì£¼ë¬¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ ìƒíƒœ í™•ì¸
        window.onload = function() {
            checkServerStatus();
        };
    </script>
</body>
</html>