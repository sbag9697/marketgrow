<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìµœì¢… Mock ì œê±° í™•ì¸</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 50px;
            background: #f7f7f7;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-item.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-item.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ìµœì¢… Mock ì œê±° í™•ì¸</h1>
        
        <div id="statusList"></div>
        
        <div style="margin-top: 30px;">
            <button onclick="cleanAll()" class="danger">ğŸ—‘ï¸ ëª¨ë“  Mock ë°ì´í„° ì œê±°</button>
            <button onclick="testRealAPI()">ğŸ“¡ ì‹¤ì œ API í…ŒìŠ¤íŠ¸</button>
            <button onclick="goToSignup()" class="success">âœ… íšŒì›ê°€ì… í˜ì´ì§€ë¡œ</button>
        </div>
        
        <div id="apiTestResult" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; display: none;">
            <h3>API í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
            <pre id="apiResult"></pre>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        function checkStatus() {
            const statusList = document.getElementById('statusList');
            statusList.innerHTML = '';
            
            const checks = [
                {
                    name: 'localStorage.useMockServer',
                    value: localStorage.getItem('useMockServer'),
                    expected: null
                },
                {
                    name: 'localStorage.mockMode',
                    value: localStorage.getItem('mockMode'),
                    expected: null
                },
                {
                    name: 'localStorage.testMode',
                    value: localStorage.getItem('testMode'),
                    expected: null
                },
                {
                    name: 'localStorage.mockUsers',
                    value: localStorage.getItem('mockUsers'),
                    expected: null
                },
                {
                    name: 'window.mockAPI',
                    value: window.mockAPI ? 'exists' : null,
                    expected: null
                },
                {
                    name: 'mock-api.js ë¡œë“œ ìƒíƒœ',
                    value: checkScriptLoaded('mock-api.js'),
                    expected: false
                },
                {
                    name: 'auto-mock.js ë¡œë“œ ìƒíƒœ',
                    value: checkScriptLoaded('auto-mock.js'),
                    expected: false
                }
            ];
            
            checks.forEach(check => {
                const div = document.createElement('div');
                div.className = 'status-item';
                
                const isOk = check.value === check.expected;
                div.className += isOk ? ' success' : ' error';
                
                div.innerHTML = `
                    <span>${check.name}</span>
                    <span>
                        ${check.value === null || check.value === false ? 'âŒ ë¹„í™œì„±' : `âš ï¸ ${check.value}`}
                    </span>
                `;
                
                statusList.appendChild(div);
            });
            
            // ì „ì²´ ìƒíƒœ í‘œì‹œ
            const allClear = checks.every(c => c.value === c.expected);
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'status-item ' + (allClear ? 'success' : 'error');
            summaryDiv.style.marginTop = '20px';
            summaryDiv.style.fontWeight = 'bold';
            summaryDiv.innerHTML = allClear 
                ? 'âœ… ëª¨ë“  Mock ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ì‹¤ì œ APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.'
                : 'âš ï¸ Mock ëª¨ë“œê°€ ì•„ì§ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
            statusList.appendChild(summaryDiv);
        }
        
        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸
        function checkScriptLoaded(filename) {
            const scripts = document.getElementsByTagName('script');
            for (let script of scripts) {
                if (script.src && script.src.includes(filename)) {
                    return true;
                }
            }
            return false;
        }
        
        // ëª¨ë“  Mock ë°ì´í„° ì œê±°
        function cleanAll() {
            console.log('ğŸ§¹ ëª¨ë“  Mock ë°ì´í„° ì œê±° ì¤‘...');
            
            // localStorage ì™„ì „ ì •ë¦¬
            const keysToRemove = [
                'useMockServer',
                'mockMode',
                'testMode',
                'mockUsers',
                'mockOrders',
                'mockData',
                'enableMock'
            ];
            
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key) !== null) {
                    console.log(`Removing localStorage.${key}`);
                    localStorage.removeItem(key);
                }
            });
            
            // ì¶”ê°€ë¡œ mock ê´€ë ¨ ëª¨ë“  í‚¤ ì œê±°
            Object.keys(localStorage).forEach(key => {
                if (key.toLowerCase().includes('mock') || key.toLowerCase().includes('test')) {
                    console.log(`Removing localStorage.${key}`);
                    localStorage.removeItem(key);
                }
            });
            
            // sessionStorage ì •ë¦¬
            sessionStorage.clear();
            
            // window ê°ì²´ ì •ë¦¬
            if (window.mockAPI) {
                delete window.mockAPI;
                console.log('window.mockAPI ì œê±°ë¨');
            }
            
            alert('âœ… ëª¨ë“  Mock ë°ì´í„°ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!');
            checkStatus();
        }
        
        // ì‹¤ì œ API í…ŒìŠ¤íŠ¸
        async function testRealAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            const result = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            result.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const response = await fetch('https://marketgrow-production.up.railway.app/api/health', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `âœ… ì‹¤ì œ ì„œë²„ ì—°ê²° ì„±ê³µ!\n\nì‘ë‹µ:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    result.innerHTML = `âš ï¸ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                result.innerHTML = `âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨\n\nì˜¤ë¥˜:\n${error.message}\n\nì‹¤ì œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`;
            }
        }
        
        // íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™
        function goToSignup() {
            // ì´ë™ ì „ í•œë²ˆ ë” ì •ë¦¬
            localStorage.removeItem('useMockServer');
            localStorage.removeItem('mockMode');
            localStorage.removeItem('testMode');
            
            window.location.href = 'signup.html';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            checkStatus();
            
            // 3ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            setInterval(checkStatus, 3000);
        });
    </script>
</body>
</html>