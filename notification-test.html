<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ - MarketGrow</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile-fix.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #1a365d;
            margin-bottom: 10px;
        }

        .description {
            color: #64748b;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .test-section h3 {
            color: #1a365d;
            margin-bottom: 15px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .test-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .test-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .test-btn.danger {
            background: #dc2626;
        }

        .status-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: #64748b;
            font-weight: 500;
        }

        .status-value {
            color: #1a365d;
            font-weight: 600;
        }

        .connected {
            color: #10b981;
        }

        .disconnected {
            color: #ef4444;
        }

        .log-panel {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-time {
            color: #94a3b8;
        }

        .log-success {
            color: #10b981;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-list i {
            color: #10b981;
        }
    </style>
    <!-- Auth Check -->
    <script src="js/auth-check.js"></script>
</head>
<body>
    <!-- Navigation (ê°„ë‹¨í•œ ë²„ì „) -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="logo-icon">MG</div>
                <h2><a href="index.html">MarketGrow</a></h2>
            </div>
            <ul class="nav-menu">
                <li><a href="dashboard.html">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="services.html">ì„œë¹„ìŠ¤</a></li>
                <!-- ì•Œë¦¼ ë²„íŠ¼ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </ul>
        </div>
    </nav>

    <div class="test-container">
        <h1>ğŸ”” ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        <p class="description">
            ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì•Œë¦¼ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ì•Œë¦¼ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
        </p>

        <!-- ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ -->
        <div class="test-section">
            <h3>ğŸ“¬ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h3>
            <div class="test-grid">
                <button class="test-btn" onclick="testOrderNotification('pending')">
                    <i class="fas fa-clock"></i> ì£¼ë¬¸ ì ‘ìˆ˜
                </button>
                <button class="test-btn" onclick="testOrderNotification('processing')">
                    <i class="fas fa-cog"></i> ì²˜ë¦¬ ì‹œì‘
                </button>
                <button class="test-btn" onclick="testOrderNotification('in_progress')">
                    <i class="fas fa-spinner"></i> ì§„í–‰ì¤‘
                </button>
                <button class="test-btn" onclick="testOrderNotification('completed')">
                    <i class="fas fa-check"></i> ì™„ë£Œ
                </button>
                <button class="test-btn danger" onclick="testOrderNotification('cancelled')">
                    <i class="fas fa-times"></i> ì·¨ì†Œ
                </button>
                <button class="test-btn secondary" onclick="testPaymentNotification(true)">
                    <i class="fas fa-credit-card"></i> ê²°ì œ ì„±ê³µ
                </button>
                <button class="test-btn secondary" onclick="testPaymentNotification(false)">
                    <i class="fas fa-exclamation"></i> ê²°ì œ ì‹¤íŒ¨
                </button>
                <button class="test-btn secondary" onclick="testPromotionNotification()">
                    <i class="fas fa-gift"></i> í”„ë¡œëª¨ì…˜
                </button>
            </div>
        </div>

        <!-- ì•Œë¦¼ ì œì–´ -->
        <div class="test-section">
            <h3>âš™ï¸ ì•Œë¦¼ ì œì–´</h3>
            <div class="test-grid">
                <button class="test-btn secondary" onclick="toggleSound()">
                    <i class="fas fa-volume-up"></i> ì†Œë¦¬ í† ê¸€
                </button>
                <button class="test-btn secondary" onclick="requestPermission()">
                    <i class="fas fa-bell"></i> ê¶Œí•œ ìš”ì²­
                </button>
                <button class="test-btn secondary" onclick="markAllRead()">
                    <i class="fas fa-check-double"></i> ëª¨ë‘ ì½ìŒ
                </button>
                <button class="test-btn danger" onclick="clearAll()">
                    <i class="fas fa-trash"></i> ëª¨ë‘ ì‚­ì œ
                </button>
            </div>
        </div>

        <!-- ìƒíƒœ íŒ¨ë„ -->
        <div class="status-panel">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <div class="status-item">
                <span class="status-label">WebSocket ì—°ê²°:</span>
                <span class="status-value" id="wsStatus">í™•ì¸ì¤‘...</span>
            </div>
            <div class="status-item">
                <span class="status-label">ì•Œë¦¼ ê¶Œí•œ:</span>
                <span class="status-value" id="permissionStatus">í™•ì¸ì¤‘...</span>
            </div>
            <div class="status-item">
                <span class="status-label">ì•Œë¦¼ìŒ:</span>
                <span class="status-value" id="soundStatus">ì¼œì§</span>
            </div>
            <div class="status-item">
                <span class="status-label">ì´ ì•Œë¦¼ ìˆ˜:</span>
                <span class="status-value" id="totalCount">0ê°œ</span>
            </div>
            <div class="status-item">
                <span class="status-label">ì½ì§€ ì•Šì€ ì•Œë¦¼:</span>
                <span class="status-value" id="unreadCount">0ê°œ</span>
            </div>
        </div>

        <!-- ê¸°ëŠ¥ ëª©ë¡ -->
        <div class="test-section">
            <h3>âœ… êµ¬í˜„ëœ ê¸°ëŠ¥</h3>
            <ul class="feature-list">
                <li><i class="fas fa-check"></i> ì‹¤ì‹œê°„ WebSocket ì—°ê²° (ìë™ ì¬ì—°ê²°)</li>
                <li><i class="fas fa-check"></i> ì£¼ë¬¸ ìƒíƒœë³„ ì•Œë¦¼ (ëŒ€ê¸°/ì²˜ë¦¬ì¤‘/ì§„í–‰ì¤‘/ì™„ë£Œ/ì·¨ì†Œ)</li>
                <li><i class="fas fa-check"></i> ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼</li>
                <li><i class="fas fa-check"></i> í”„ë¡œëª¨ì…˜ ì•Œë¦¼</li>
                <li><i class="fas fa-check"></i> ë¸Œë¼ìš°ì € ë°ìŠ¤í¬í†± í‘¸ì‹œ ì•Œë¦¼</li>
                <li><i class="fas fa-check"></i> í† ìŠ¤íŠ¸ ì•Œë¦¼ (ìš°ì¸¡ ìƒë‹¨)</li>
                <li><i class="fas fa-check"></i> ì•Œë¦¼ ì„¼í„° (ì¢… ì•„ì´ì½˜)</li>
                <li><i class="fas fa-check"></i> ì•Œë¦¼ìŒ ì¬ìƒ</li>
                <li><i class="fas fa-check"></i> ì½ìŒ/ì½ì§€ì•ŠìŒ ìƒíƒœ ê´€ë¦¬</li>
                <li><i class="fas fa-check"></i> 24ì‹œê°„ ì•Œë¦¼ ë³´ê´€</li>
                <li><i class="fas fa-check"></i> ì•Œë¦¼ë³„ ì•¡ì…˜ ë²„íŠ¼</li>
                <li><i class="fas fa-check"></i> ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥</li>
            </ul>
        </div>

        <!-- ë¡œê·¸ íŒ¨ë„ -->
        <div class="log-panel" id="logPanel">
            <div class="log-entry">
                <span class="log-time">[00:00:00]</span> 
                <span class="log-info">ì•Œë¦¼ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</span>
            </div>
        </div>
    </div>

    <script src="js/notification-system.js"></script>
    <script>
        // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logPanel = document.getElementById('logPanel');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-time">[${time}]</span> 
                <span class="log-${type}">${message}</span>
            `;
            logPanel.appendChild(logEntry);
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus() {
            // WebSocket ìƒíƒœ
            const wsStatus = document.getElementById('wsStatus');
            if (notificationSystem && notificationSystem.isConnected) {
                wsStatus.innerHTML = '<span class="connected">ì—°ê²°ë¨</span>';
            } else {
                wsStatus.innerHTML = '<span class="disconnected">ì—°ê²° ì•ˆë¨</span>';
            }

            // ì•Œë¦¼ ê¶Œí•œ
            const permissionStatus = document.getElementById('permissionStatus');
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    permissionStatus.innerHTML = '<span class="connected">í—ˆìš©ë¨</span>';
                } else if (Notification.permission === 'denied') {
                    permissionStatus.innerHTML = '<span class="disconnected">ê±°ë¶€ë¨</span>';
                } else {
                    permissionStatus.innerHTML = 'ìš”ì²­ í•„ìš”';
                }
            } else {
                permissionStatus.innerHTML = '<span class="disconnected">ì§€ì› ì•ˆë¨</span>';
            }

            // ì•Œë¦¼ ìˆ˜
            document.getElementById('totalCount').textContent = 
                notificationSystem.notifications.length + 'ê°œ';
            document.getElementById('unreadCount').textContent = 
                notificationSystem.unreadCount + 'ê°œ';
        }

        // ì£¼ë¬¸ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
        function testOrderNotification(status) {
            const orderId = 'TEST_' + Date.now();
            notificationSystem.handleNotification({
                type: 'order_status',
                orderId: orderId,
                status: status,
                serviceName: 'ì¸ìŠ¤íƒ€ê·¸ë¨ íŒ”ë¡œì›Œ 1000ê°œ'
            });
            addLog(`ì£¼ë¬¸ ìƒíƒœ ì•Œë¦¼ í…ŒìŠ¤íŠ¸: ${status}`, 'success');
            updateStatus();
        }

        // ê²°ì œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
        function testPaymentNotification(success) {
            notificationSystem.handleNotification({
                type: 'payment',
                success: success,
                message: success ? 
                    'ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤' : 
                    'ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
            });
            addLog(`ê²°ì œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸: ${success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`, success ? 'success' : 'error');
            updateStatus();
        }

        // í”„ë¡œëª¨ì…˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
        function testPromotionNotification() {
            notificationSystem.handleNotification({
                type: 'promotion',
                message: 'ğŸ‰ ì‹ ê·œ ê°€ì… 50% í• ì¸ ì´ë²¤íŠ¸! ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”.',
                url: '/promotions'
            });
            addLog('í”„ë¡œëª¨ì…˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸', 'success');
            updateStatus();
        }

        // ì†Œë¦¬ í† ê¸€
        function toggleSound() {
            notificationSystem.soundEnabled = !notificationSystem.soundEnabled;
            document.getElementById('soundStatus').textContent = 
                notificationSystem.soundEnabled ? 'ì¼œì§' : 'êº¼ì§';
            addLog(`ì•Œë¦¼ìŒ ${notificationSystem.soundEnabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`, 'info');
        }

        // ê¶Œí•œ ìš”ì²­
        async function requestPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                addLog(`ì•Œë¦¼ ê¶Œí•œ: ${permission}`, permission === 'granted' ? 'success' : 'error');
                updateStatus();
            } else {
                addLog('ë¸Œë¼ìš°ì €ê°€ ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ëª¨ë‘ ì½ìŒ
        function markAllRead() {
            notificationSystem.markAllAsRead();
            addLog('ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤', 'success');
            updateStatus();
        }

        // ëª¨ë‘ ì‚­ì œ
        function clearAll() {
            if (confirm('ëª¨ë“  ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                notificationSystem.notifications = [];
                notificationSystem.unreadCount = 0;
                notificationSystem.saveNotifications();
                notificationSystem.updateNotificationList();
                notificationSystem.updateUnreadBadge();
                addLog('ëª¨ë“  ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                updateStatus();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                updateStatus();
                addLog('ì•Œë¦¼ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ', 'success');
                
                // ìƒíƒœ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
                setInterval(updateStatus, 1000);
            }, 1000);
        });

        // í…ŒìŠ¤íŠ¸ìš©: ë¡œê·¸ì¸ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
        if (!localStorage.getItem('authToken')) {
            localStorage.setItem('authToken', 'test_token_' + Date.now());
            localStorage.setItem('userInfo', JSON.stringify({
                id: 'test_user',
                name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                email: 'test@marketgrow.kr'
            }));
            addLog('í…ŒìŠ¤íŠ¸ìš© ë¡œê·¸ì¸ í† í° ìƒì„±', 'info');
        }
    </script>
    <script src="js/mobile-fix.js"></script>
</body>
</html>