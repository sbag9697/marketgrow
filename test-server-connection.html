<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background: #fafafa;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title {
            font-weight: bold;
            color: #555;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pending {
            background: #f0f0f0;
            color: #666;
        }
        .status.testing {
            background: #fff3cd;
            color: #856404;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .test-details {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 3px;
            font-size: 14px;
            display: none;
        }
        .test-details.show {
            display: block;
        }
        .test-url {
            color: #667eea;
            word-break: break-all;
        }
        .error-msg {
            color: #dc3545;
            margin-top: 5px;
        }
        .success-msg {
            color: #28a745;
            margin-top: 5px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .alternatives {
            margin-top: 30px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        .alternatives h3 {
            margin-top: 0;
            color: #667eea;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Œ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        
        <button onclick="runAllTests()" id="testBtn">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="useLocalMode()" id="localBtn">ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜</button>
        
        <div id="tests">
            <div class="test-item" data-test="railway">
                <div class="test-header">
                    <span class="test-title">Railway í”„ë¡œë•ì…˜ ì„œë²„</span>
                    <span class="status pending" id="railway-status">ëŒ€ê¸°ì¤‘</span>
                </div>
                <div class="test-details" id="railway-details">
                    <div class="test-url">https://marketgrow-production.up.railway.app/api</div>
                </div>
            </div>
            
            <div class="test-item" data-test="local">
                <div class="test-header">
                    <span class="test-title">ë¡œì»¬ ê°œë°œ ì„œë²„</span>
                    <span class="status pending" id="local-status">ëŒ€ê¸°ì¤‘</span>
                </div>
                <div class="test-details" id="local-details">
                    <div class="test-url">http://localhost:5001/api</div>
                </div>
            </div>
            
            <div class="test-item" data-test="health">
                <div class="test-header">
                    <span class="test-title">Health Check ì—”ë“œí¬ì¸íŠ¸</span>
                    <span class="status pending" id="health-status">ëŒ€ê¸°ì¤‘</span>
                </div>
                <div class="test-details" id="health-details">
                    <div class="test-url">/health ë˜ëŠ” /ping</div>
                </div>
            </div>
            
            <div class="test-item" data-test="cors">
                <div class="test-header">
                    <span class="test-title">CORS ì„¤ì • í™•ì¸</span>
                    <span class="status pending" id="cors-status">ëŒ€ê¸°ì¤‘</span>
                </div>
                <div class="test-details" id="cors-details">
                    <div class="test-url">OPTIONS ìš”ì²­</div>
                </div>
            </div>
        </div>
        
        <div class="alternatives" id="alternatives" style="display: none;">
            <h3>ğŸ› ï¸ ëŒ€ì²´ ë°©ì•ˆ</h3>
            <p>ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í•œ ê²½ìš° ë‹¤ìŒ ë°©ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”:</p>
            
            <h4>1. ë¡œì»¬ ì„œë²„ ì‹¤í–‰</h4>
            <div class="code-block">
cd backend
npm install
npm run dev
            </div>
            
            <h4>2. ì„ì‹œ í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‚¬ìš©</h4>
            <p>config.js íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •:</p>
            <div class="code-block">
const API_CONFIG = {
    BASE_URL: 'http://localhost:5001/api', // ë¡œì»¬ ì„œë²„ ì‚¬ìš©
    TIMEOUT: 30000,
    HEADERS: {
        'Content-Type': 'application/json'
    }
};
            </div>
            
            <h4>3. Mock ì„œë²„ ì‚¬ìš©</h4>
            <p>í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Mock ì„œë²„ë¥¼ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button onclick="enableMockServer()">Mock ì„œë²„ í™œì„±í™”</button>
        </div>
    </div>

    <script>
        // í…ŒìŠ¤íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(testId, status, message) {
            const statusEl = document.getElementById(`${testId}-status`);
            const detailsEl = document.getElementById(`${testId}-details`);
            
            statusEl.className = `status ${status}`;
            statusEl.textContent = status === 'testing' ? 'í…ŒìŠ¤íŠ¸ì¤‘...' :
                                   status === 'success' ? 'ì„±ê³µ' :
                                   status === 'error' ? 'ì‹¤íŒ¨' : 'ëŒ€ê¸°ì¤‘';
            
            if (message) {
                const msgEl = document.createElement('div');
                msgEl.className = status === 'success' ? 'success-msg' : 'error-msg';
                msgEl.textContent = message;
                detailsEl.appendChild(msgEl);
                detailsEl.classList.add('show');
            }
        }
        
        // Railway ì„œë²„ í…ŒìŠ¤íŠ¸
        async function testRailwayServer() {
            updateStatus('railway', 'testing');
            
            try {
                const response = await fetch('https://marketgrow-production.up.railway.app/api/health', {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    updateStatus('railway', 'success', `âœ… ì„œë²„ ì‘ë‹µ: ${response.status} OK`);
                    return true;
                } else {
                    updateStatus('railway', 'error', `âŒ ì„œë²„ ì‘ë‹µ: ${response.status} ${response.statusText}`);
                    return false;
                }
            } catch (error) {
                updateStatus('railway', 'error', `âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                return false;
            }
        }
        
        // ë¡œì»¬ ì„œë²„ í…ŒìŠ¤íŠ¸
        async function testLocalServer() {
            updateStatus('local', 'testing');
            
            try {
                const response = await fetch('http://localhost:5001/api/health', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    updateStatus('local', 'success', `âœ… ì„œë²„ ì‘ë‹µ: ${response.status} OK`);
                    return true;
                } else {
                    updateStatus('local', 'error', `âŒ ì„œë²„ ì‘ë‹µ: ${response.status} ${response.statusText}`);
                    return false;
                }
            } catch (error) {
                updateStatus('local', 'error', `âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                return false;
            }
        }
        
        // Health Check í…ŒìŠ¤íŠ¸
        async function testHealthCheck() {
            updateStatus('health', 'testing');
            
            const endpoints = [
                'https://marketgrow-production.up.railway.app/api/health',
                'https://marketgrow-production.up.railway.app/api/ping',
                'https://marketgrow-production.up.railway.app/health',
                'https://marketgrow-production.up.railway.app/'
            ];
            
            for (const url of endpoints) {
                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    if (response.ok || response.status < 500) {
                        updateStatus('health', 'success', `âœ… ì—”ë“œí¬ì¸íŠ¸ ë°œê²¬: ${url}`);
                        return true;
                    }
                } catch (error) {
                    console.log(`Failed: ${url}`);
                }
            }
            
            updateStatus('health', 'error', 'âŒ Health check ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            return false;
        }
        
        // CORS í…ŒìŠ¤íŠ¸
        async function testCORS() {
            updateStatus('cors', 'testing');
            
            try {
                const response = await fetch('https://marketgrow-production.up.railway.app/api', {
                    method: 'OPTIONS',
                    mode: 'cors',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                
                const corsHeaders = response.headers.get('Access-Control-Allow-Origin');
                if (corsHeaders) {
                    updateStatus('cors', 'success', `âœ… CORS í—ˆìš©: ${corsHeaders}`);
                    return true;
                } else {
                    updateStatus('cors', 'error', 'âŒ CORS í—¤ë”ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    return false;
                }
            } catch (error) {
                updateStatus('cors', 'error', `âŒ CORS í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                return false;
            }
        }
        
        // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const results = await Promise.all([
                testRailwayServer(),
                testLocalServer(),
                testHealthCheck(),
                testCORS()
            ]);
            
            testBtn.disabled = false;
            testBtn.textContent = 'ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰';
            
            // ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•œ ê²½ìš° ëŒ€ì²´ ë°©ì•ˆ í‘œì‹œ
            if (!results.some(r => r)) {
                document.getElementById('alternatives').style.display = 'block';
            }
        }
        
        // ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜
        function useLocalMode() {
            const script = document.createElement('script');
            script.textContent = `
                window.API_CONFIG = {
                    BASE_URL: 'http://localhost:5001/api',
                    TIMEOUT: 30000,
                    HEADERS: {
                        'Content-Type': 'application/json'
                    }
                };
                console.log('ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤:', window.API_CONFIG);
            `;
            document.head.appendChild(script);
            
            alert('ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œì»¬ ì„œë²„(í¬íŠ¸ 5001)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
            window.location.reload();
        }
        
        // Mock ì„œë²„ í™œì„±í™”
        function enableMockServer() {
            localStorage.setItem('useMockServer', 'true');
            alert('Mock ì„œë²„ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì ìš©ë©ë‹ˆë‹¤.');
            window.location.reload();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            console.log('í˜„ì¬ API ì„¤ì •:', window.API_CONFIG);
            // runAllTests();
        };
    </script>
</body>
</html>